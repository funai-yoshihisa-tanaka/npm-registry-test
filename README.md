# **プライベートNPMレジストリ設定 動作確認手順書**

## **概要**

このドキュメントは、npmパッケージのインストール元を社内のプライベートレジストリに限定する設定が正しく機能しているかを確認するための手順書です。

Docker Composeを使用して、設定が適用された環境 (filtered) と、適用されていない環境 (non-filtered) を用意し、それぞれの環境でパッケージのインストールを試みます。

## **前提条件**

* Dockerがインストールされていること  
* Docker Composeがインストールされていること

## **動作確認手順**

### **Step 1: Dockerコンテナの起動**

プロジェクトのルートディレクトリで以下のコマンドを実行し、2つのコンテナをバックグラウンドで起動します。

``` txt
docker compose up -d
```

### **Step 2: non-filtered 環境での動作確認 (設定なし)**

まず、設定が適用されていない non-filtered コンテナに入り、npm installを試します。この環境では、公式のnpmレジストリに接続されます。

1. 以下のコマンドでコンテナに接続します。
    ``` txt
    docker compose exec non-filtered bash
    ```

2. コンテナ内で、プライベートレジストリに**存在しない**パッケージ (husky@9.1.6) をインストールします。  
    ``` txt
    root@xxxxxxxxxxxx:/app# npm install husky@9.1.6
    ```

   \=\> **\[期待される結果\]** 公式npmレジストリからダウンロードされ、**インストールが成功する**。  
3. 次に、プライベートレジストリに**存在する**パッケージ (husky@9.1.7) をインストールします。  
    ``` txt
    root@xxxxxxxxxxxx:/app# npm install husky@9.1.7
    ```

   \=\> **\[期待される結果\]** 公式npmレジストリからダウンロードされ、**インストールが成功する**。  
4. 確認が終わったら、exitコマンドでコンテナから抜けます。  
    ``` txt
    root@xxxxxxxxxxxx:/app# exit
    ```

### **Step 3: filtered 環境での動作確認 (設定あり)**

次に、プライベートレジストリの設定が適用された filtered コンテナで同じテストを行います。この環境では、社内のプライベートレジストリにのみ接続されます。

1. 以下のコマンドでコンテナに接続します。  
    ``` txt
    docker compose exec filtered bash
    ```

2. コンテナ内で、プライベートレジストリに**存在しない**パッケージ (husky@9.1.6) をインストールします。  
    ``` txt
    root@xxxxxxxxxxxx:/app# npm install husky@9.1.6
    ```

   \=\> **\[期待される結果\]** プライベートレジストリにパッケージが存在しないため、404 Not Found のようなエラーが発生し、**インストールが失敗する**。  
3. 次に、プライベートレジストリに**存在する**パッケージ (husky@9.1.7) をインストールします。  
    ``` txt
    root@xxxxxxxxxxxx:/app# npm install husky@9.1.7
    ```

   \=\> **\[期待される結果\]** プライベートレジストリからパッケージがダウンロードされ、**インストールが成功する**。  
4. 確認が終わったら、exitコマンドでコンテナから抜けます。
    ``` txt  
    root@xxxxxxxxxxxx:/app# exit
    ```

### **Step 4: クリーンアップ**

テストが完了したら、以下のコマンドでコンテナを停止・削除します。

docker compose down

## **確認結果のまとめ**

| 環境 | パッケージ (husky@9.1.6) (プライベートリポジトリにない) | パッケージ (husky@9.1.7) (プライベートリポジトリにある) |
| :---- | :---- | :---- |
| non-filtered | ✅ **成功** | ✅ **成功** |
| filtered | ❌ **失敗** | ✅ **成功** |

filtered環境で上記の結果となれば、プライベートレジストリへの限定設定が正しく機能していることが確認できます。